{% extends "base.htm" %}

{% block nav%}
<li><a href="/add">Post</a></li>
<li class="active"><a href="/browse">Browse</a></li>
{% endblock %}

{% block head %}
<style>
	#map_canvas { height: 300px; width:100%; }

	.map_info_who { font-weight:bold}
	.map_info_place_name { text-decoration:italic}
	.map_info_addressP{ font-size:5px	}
</style>

<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=places&sensor=false"></script>
<script type="text/javascript" src="http://code.google.com/apis/gears/gears_init.js"></script>
<script type="text/javascript" src="/JS/search_map.js"></script>

<script type="text/javascript">

var count = 1;

function findItems(){
	$("#received").html( "FindItems: " + count ++ );
	var bounds = map.getBounds();
	// Make the AJAX call to get the items within bounds
	$.ajax( {
				url: "/get_items?bounds=" + bounds.toUrlValue() + '&json=1', 
				dataType: 'json',
				error: function(jqXHR, textStatus, errorThrown){
					$("#received").html( "There was an error: " + jqXHR + ", " + textStatus + ", "+ errorThrown );
				},
				success: function( items_json ){
					$("#received").html( "he: " + items_json );
					cleanMarkerList();
					var locations = eval( items_json );
					
					
					for( var loc in locations ){
						
						var coordinates = loc.split( "|");
						var items = locations[loc];
						createEventMarker( coordinates[0], coordinates[1], 
								"<div class='map_info_who'>" + items.length + " people hanging out at </div>" +
								"<div class='map_info_place_name'>" + items[0].where_name +  "</div>" + 
								"<div class='map_info_address'>" + items[0].where_addr + "</div>");
					} 
					
					
				} 
			});
	
}

$(function () {
	init_map_stuff( findItems );
	initMyExistingPosition();
});

</script>
{% endblock %}

{% block main %}
<div id="received">Gonna</div>
<div id="map_canvas" ></div>

    {% for event in events %}
		{% include "event_snip.htm" %}
    {% endfor %}
    Display map
    <a href='/home'>Back</a>
{% endblock %}